this.nvpack=this.nvpack||{},this.nvpack.anal=function(){"use strict";var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n=function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")},i=function(){function t(t,n){for(var i=0;i<n.length;i++){var e=n[i];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(n,i,e){return i&&t(n.prototype,i),e&&t(n,e),n}}(),e=function(){function t(){n(this,t),this.document=window.document}return i(t,[{key:"set",value:function(t,n,i,e){var s=new Date((new Date).setHours(23,59,59,0));i=i||0==i?"expires="+i:"expires="+s,e=e?"domain=."+e:"",document.cookie=t+"="+n+"; "+i+"; "+e+"; path=/"}},{key:"get",value:function(t){for(var n=t+"=",i=document.cookie.split(";"),e=0;e<i.length;e++){var s=i[e].trim();if(0==s.indexOf(n))return s.substring(n.length,s.length)}return null}},{key:"remove",value:function(t){document.cookie=t+"=; Max-Age=-99999999;"}},{key:"setLS",value:function(t,n){return localStorage.setItem(t,n)}},{key:"getLS",value:function(t){return localStorage.getItem(t)}},{key:"duration",value:function(t){var n=1,i="Fri, 31 Dec 1999 23:59:59 GMT";if(t)if(501==t)i="Fri, 31 Dec 1999 23:59:59 GMT";else if(0==t)i=0;else{500==t?n=365:t>0&&t<=90&&(n=t);var e=new Date;1!=n&&(n-=1,e.setTime(e.getTime()+24*n*60*60*1e3)),e.setHours(23,59,59,0),i=e}return i}}]),t}(),s=function(){var t=window.document,n=0,i=void 0,e=void 0;return{get:function(s,o,u,r){var a=-1!==s.indexOf("?")?"&":"?";o=o||{};for(e in o)o.hasOwnProperty(e)&&(a+=encodeURIComponent(e)+"="+encodeURIComponent(o[e])+"&");var c,h,f,v=u+ ++n;return window[v]=function(t){r(t);try{delete window[v]}catch(t){}window[v]=null},c=s+a+"js_callback="+v,h=t.createElement("script"),f=!1,h.src=c,h.async=!0,h.onload=h.onreadystatechange=function(){f||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(f=!0,h.onload=h.onreadystatechange=null,h&&h.parentNode&&h.parentNode.removeChild(h))},!i&&(i=t.getElementsByTagName("head")[0]),i.appendChild(h),v},post:function(t,n,i,e,s){s.ajax({url:t,type:"POST",data:n,contentType:!1,processData:!1,success:e})}}},o=function(){return{bind:function(t,n,i,e){return e&&""!=e&&(window.notify_visitors.eventsRecord=window.notify_visitors.eventsRecord||{},window.notify_visitors.eventsRecord[e]=window.notify_visitors.eventsRecord[e]||[],window.notify_visitors.eventsRecord[e].push({n:n,e:t,c:i})),t.addEventListener?t.addEventListener(n,i):t.attachEvent?t.attachEvent("on"+n,i):void 0},unbind:function(t,n,i){return t.removeEventListener?t.removeEventListener(n,i):t.detachEvent?t.detachEvent("on"+n,i):void 0}}},u=function(){return{send:function(t,n){var i=new CustomEvent("notifyvisitors_callback",{detail:{data:t,url:document.location.href,type:n}});window.dispatchEvent(i)}}},r="https://analytics.notifyvisitors.com/",a={event:r+"brand/t1/event",user:r+"brand/t1/users",dimensions:r+"brand/t1/dimensions",userSessions:r+"brand/t1/userSessions"},c=new Date,h=function(){function r(t){n(this,r),this.response={},this.config=this.config||{},this.data=this.data||{},this.bindEvent=o(),this.callbackNotifyEvent=u(),this.getJSONP=s(),this.callbackName="nv_anal_json",this.productName="analytics",this.cookieController=new e,this.trackUserSessions=this.trackUserSessions.bind(this),this.checkAuth(t),this.nvHandler}return i(r,[{key:"checkAuth",value:function(t){this.response=t,void 0!=t.auth&&(void 0!=t.async&&!1!==t.async?handleWindowLoad():this.init())}},{key:"handleWindowLoad",value:function(){"complete"==document.readyState?this.init():this.bindEvent.bind(window,"load",init,this.productName)}},{key:"init",value:function(){if(nvpack.config=nvpack.config||{},nvpack.config.a)return!1;nvpack.config.a=!0,this.config.urls=a,this.data.auth=this.response.auth||{},this.data.setting=this.response.auth||{},this.data.auth.ruleData&&(this.data.setting.ruleData=this.data.auth.ruleData=this.response.ruleData),this.response.tokens&&(this.data.setting.tokens=this.data.auth.tokens=this.response.tokens),this.data.setting.trafficSource=this.data.auth.trafficSource=document.referrer,this.data.setting.isPwa=window.matchMedia("(display-mode: standalone)").matches?1:0,this.data.setting.pageUrl=this.data.auth.pageUrl=document.location,this.data.setting.gmOffset=this.data.auth.gmOffset=60*c.getTimezoneOffset()*-1,this.data.setting.screenWidth=this.data.auth.screenWidth=screen.width,this.data.setting.screenHeight=this.data.auth.screenHeight=screen.height,this.load()}},{key:"load",value:function(){var t=this;if("fail"==this.response.Authentication)return!1;if(this.trackUserSessions(),this.nvHandler=function(n){var i=Array.prototype.slice.call(n);t.performEventActions(i)},t.response.event_integration){var n=t.response.event_integration;t.eventAction(n.event,n.attributes,n.ltv,n.scope)}}},{key:"trackUserSessions",value:function(t){var n=this,i=!0;if("fail"==this.response.Authentication)return!1;if(this.response.brandID&&this.response.brandID>0&&this.response.userID>0){var e=n.cookieController.get("_nv_user_sess");if(e&&!t){var s=((new Date).getTime()-parseInt(e))/6e4;s>0&&s<30&&(i=!1)}if(i){n.cookieController.set("_nv_user_sess",(new Date).getTime(),"1969-12-31T23:59:59.000Z");var o=Object.assign({userID:this.response.userID},n.data.setting);n.getJSONP.get(n.config.urls.userSessions,o,"handelSuccessTrackSession",this.handelSuccessTrackSession.bind(this))}}}},{key:"handelSuccessTrackSession",value:function(t){1===t.status&&void 0!==t.callback_data&&this.callbackNotifyEvent.send(t.callback_data,"userSession")}},{key:"performEventActions",value:function(t){var n=this;if(!t[0])return!1;switch(t[0]){case"user":n.userAction(t[1],t[2]);break;case"pushuser":n.cookieController.get("nv_push_subscribe")&&n.userAction(t[1],t[2]);break;case"event":n.eventAction(t[1],t[2],t[3],t[4]);break;case"pushevent":n.pusheventAction(t[1],t[2],t[3],t[4]);break;case"pushsubscribe":n.data.pushsubscribe.userID=t[1],n.data.pushsubscribe.event=t[2];break;case"dimensions":n.dimensionsAction(t[1],t[2])}}},{key:"userAction",value:function(t,n){if(t){var i=Object.assign({},this.data.setting);i.userID=t,i.userParams=n?JSON.stringify(n):"",this.getJSONP.get(this.config.urls.user,i,this.callbackName,this.userActionResponse.bind(this))}}},{key:"userActionResponse",value:function(n){"object"==(void 0===n?"undefined":t(n))&&"success"==n.Authentication&&n.userID&&this.response.userID!=n.userID&&(this.response.userID=n.userID,this.updateUserIdPushSubscribe(n),this.trackUserSessions(n.userID)),n.callback_data&&this.callbackNotifyEvent.send(n.callback_data,"user")}},{key:"updateUserIdPushSubscribe",value:function(t){t.status&&1==t.status&&window.notify_visitors.po&&window.notify_visitors.po.updateUserIdSubscription&&window.notify_visitors.po.updateUserIdSubscription(t.userID)}},{key:"pusheventAction",value:function(t,n,i,e){this.cookieController.get("nv_push_subscribe")&&eventAction(t,n,i,e)}},{key:"eventAction",value:function(t,n,i,e){if(t){var s=Object.assign({},this.data.setting);s.event_name=t,n&&(s.attributes=JSON.stringify(n)),i&&(s.ltv=i),e&&(s.scope=e),void 0!==this.data.pushsubscribe&&this.data.pushsubscribe.hasOwnProperty("userID")&&(s.userID=this.data.pushsubscribe.userID),this.getJSONP.get(this.config.urls.event,s,this.callbackName,this.eventActionResponse.bind(this))}}},{key:"eventActionResponse",value:function(t){t.callback_data&&this.callbackNotifyEvent.send(t.callback_data,"event")}},{key:"dimensionsAction",value:function(t,n){if(t&&n&&"undefined"!=typeof Storage){var i={},e=0,s=localStorage.getItem("nv_dimen");if(s?"undefined"!==(i=JSON.parse(s))[t]&&i[t]!=n&&(e=1):e=1,1==e){i[t]=n,localStorage.setItem("nv_dimen",JSON.stringify(i));var o=Object.assign({},this.data.setting);o.dimension=JSON.stringify({key:t,value:n}),this.getJSONP.get(this.config.urls.dimensions,o,this.callbackName,this.dimensionsActionResponse)}}}},{key:"dimensionsActionResponse",value:function(t){}}]),r}(),f=new h(window.notify_visitors.Events.data);return h.nvHandler=f.nvHandler,h}();
